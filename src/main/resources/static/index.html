<!DOCTYPE html>
<html lang="NO">
<head>
    <meta charset="UTF-8">
    <title>MeldingOmVedtakDataDTO Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: space-between;
        }

        .container {
            display: flex;
            width: 100%;
        }

        form {
            background: #ffffff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin-right: 20px;
        }

        .form-group {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .form-group label {
            flex: 1;
            margin-right: 10px;
            font-size: 14px;
        }

        .form-group input, .form-group textarea {
            flex: 2;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        textarea {
            resize: none;
        }

        button {
            background-color: #007BFF;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
        }

        button:hover {
            background-color: #0056b3;
        }

        iframe {
            width: 100%;
            height: 500px;
            border: 1px solid #ccc;
            display: none; /* Initially hidden */
        }

        .iframe-container {
            flex-grow: 1;
        }
    </style>
</head>
<body>
<div class="container">
    <form id="vedtakForm">
        <div class="form-group">
            <label for="jwtToken">JWT Token:</label>
            <textarea name="jwtToken" id="jwtToken" rows="2" required></textarea>
        </div>
        <div class="form-group">
            <label for="behandlingstype">Behandlingstype:</label>
            <input type="text" name="behandlingstype" value="RETT_TIL_DAGPENGER" required>
        </div>
        <div class="form-group">
            <label for="behandlingId">BehandlingId:</label>
            <input type="text" name="behandlingId" id="behandlingId" required>
        </div>
        <div class="form-group">
            <label for="fornavn">Fornavn:</label>
            <input type="text" name="fornavn" value="fornavn" required>
        </div>
        <div class="form-group">
            <label for="mellomnavn">Mellomnavn:</label>
            <input type="text" name="mellomnavn" value="mellomnavn">
        </div>
        <div class="form-group">
            <label for="etternavn">Etternavn:</label>
            <input type="text" name="etternavn" value="etternavn" required>
        </div>
        <div class="form-group">
            <label for="fodselsnummer">FÃ¸dselsnummer:</label>
            <input type="text" name="fodselsnummer" required>
        </div>
        <div class="form-group">
            <label for="sakId">SakId:</label>
            <input type="text" name="sakId" value="sakid">
        </div>
        <button type="submit">Send</button>
    </form>
    <div class="iframe-container">
        <iframe id="htmlWindow"></iframe>
    </div>
</div>
<script>
    const defaultSaksbehandler = {
        fornavn: "Test",
        etternavn: "Saksbehandler",
        enhet: {
            navn: "Testenhet",
            postadresse: "Testveien 1, 1234 Testby",
        },
        ident: "Z123456"
    };

    document.getElementById('vedtakForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const form = e.target;
        const jwtToken = form.jwtToken.value;
        const behandlingId = form.behandlingId.value;
        const data = {
            behandlingstype: form.behandlingstype.value,
            fornavn: form.fornavn.value,
            mellomnavn: form.mellomnavn.value || null,
            etternavn: form.etternavn.value,
            fodselsnummer: form.fodselsnummer.value,
            sakId: form.sakId.value || null,
            saksbehandler: defaultSaksbehandler
        };

        const response = await fetch(`/melding-om-vedtak/${behandlingId}/html`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + jwtToken
            },
            body: JSON.stringify(data)
        });

        const htmlWindow = document.getElementById('htmlWindow');

        if (response.status === 200) {
            const result = await response.json();
            htmlWindow.srcdoc = result.html; // Update iframe content
            htmlWindow.style.display = 'block'; // Show iframe
        } else {
            const errorJson = await response.json();
            htmlWindow.srcdoc = `<pre>${JSON.stringify(errorJson, null, 2)}</pre>`; // Show JSON error
            htmlWindow.style.display = 'block'; // Show iframe with error
        }
    });
</script>
</body>
</html>